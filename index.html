<!-- Code Generated by Sidekick is for learning and experimentation purposes only. -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Important Question üíç</title>

  <style>
    :root{
      --bg1:#ff758c;
      --bg2:#ff7eb3;
      --glass:rgba(255,255,255,.18);
      --text:#ffffff;
      --yes:#00c853;
      --no:#d50000;
      --accent:#00ffcc;

      --shadow: 0 20px 60px rgba(0,0,0,.22);
      --radius: 28px;
      --pad: clamp(16px, 4vw, 28px);
      --h1: clamp(28px, 5vw, 52px);
      --h2: clamp(18px, 3.4vw, 28px);
      --p:  clamp(14px, 2.8vw, 18px);
      --btn: clamp(16px, 3.2vw, 20px);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:var(--text);
      text-align:center;
      overflow:hidden;
      -webkit-tap-highlight-color: transparent;
    }

    .wrap{
      min-height:100vh;
      padding: max(env(safe-area-inset-top), 12px) var(--pad) max(env(safe-area-inset-bottom), 18px);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* Screens */
    .screen{
      display:none;
      width:min(720px, 100%);
      margin:auto;
      padding: var(--pad);
      border-radius: var(--radius);
      background: rgba(0,0,0,.14);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,.14);
      position: relative;
      overflow:hidden;
    }
    .screen.active{ display:block; }

    h1{ font-size: var(--h1); margin: 10px 0 6px; line-height:1.1; }
    h2{ font-size: var(--h2); margin: 6px 0 10px; font-weight: 800; }
    p, li, button, .small{ font-size: var(--p); }
    .small{ opacity:.9; }

    .btn-row{
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 14px;
    }

    button{
      padding: 14px 22px;
      font-size: var(--btn);
      border:none;
      border-radius: 999px;
      cursor:pointer;
      user-select:none;
      font-weight:900;
      letter-spacing:.2px;
      transition: transform .08s ease, filter .15s ease;
      box-shadow: 0 10px 28px rgba(0,0,0,.20);
      min-width: min(240px, 100%);
    }
    button:active{ transform: scale(.98); }
    button:focus-visible{
      outline: 3px solid rgba(255,255,255,.9);
      outline-offset: 3px;
    }
    .yes{ background: var(--yes); color:white; }
    .no{ background: var(--no); color:white; position:relative; }

    .msg{
      margin-top: 14px;
      min-height: 2.2em;
      font-weight: 800;
      background: var(--glass);
      border-radius: 16px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,.14);
    }

    .progress{
      width:min(520px, 100%);
      background: rgba(255,255,255,.20);
      border-radius: 999px;
      margin: 18px auto 10px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.18);
    }
    .progress-bar{
      height: 18px;
      width: 0%;
      background: var(--accent);
      border-radius: 999px;
      transition: width .04s linear;
    }
    .percent{
      font-weight: 900;
      font-size: clamp(18px, 4vw, 22px);
      margin: 6px 0 0;
    }

    .pill-row{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    .pill{
      background: var(--glass);
      border: 1px solid rgba(255,255,255,.16);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      cursor:pointer;
    }

    /* Floating controls */
    .controls{
      position:fixed;
      right: 14px;
      bottom: 14px;
      display:flex;
      gap:10px;
      z-index: 50;
    }
    .icon-btn{
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.16);
      color: white;
      font-size: 22px;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow: 0 12px 30px rgba(0,0,0,.22);
    }

    /* Hearts */
    .heart{
      position:fixed;
      top:-24px;
      font-size: 22px;
      will-change: transform, opacity;
      animation: fall linear forwards;
      pointer-events:none;
      z-index: 5;
      text-shadow: 0 10px 24px rgba(0,0,0,.18);
    }
    @keyframes fall{
      to{
        transform: translateY(110vh) rotate(12deg);
        opacity: 0;
      }
    }

    /* Modal */
    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.38);
      display:none;
      align-items:center;
      justify-content:center;
      padding: var(--pad);
      z-index: 80;
    }
    .modal-backdrop.open{ display:flex; }
    .modal{
      width: min(520px, 100%);
      border-radius: 22px;
      background: rgba(25,25,25,.55);
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: var(--shadow);
      padding: 16px 16px 14px;
      text-align:left;
    }
    .modal h3{ margin: 4px 0 6px; font-size: 20px; }
    .modal p{ margin: 6px 0 12px; opacity:.95; }
    .modal .btn-row{ justify-content:flex-end; margin-top: 8px; }
    .modal button{ min-width: 0; padding: 12px 16px; font-size: 16px; box-shadow:none; }

    /* WEDDING ANIMATION (responsive) */
    .wedding-stage{
      position: relative;
      width: min(560px, 100%);
      margin: 10px auto 0;
      padding: clamp(10px, 3vw, 18px);
      border-radius: 22px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.14);
      overflow: hidden;
    }
    .wedding-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      align-items:center;
      justify-items:center;
    }
    .bells{
      display:flex;
      gap: clamp(18px, 4vw, 28px);
      align-items:flex-start;
      justify-content:center;
      margin-top: 2px;
    }
    .bell{
      width: clamp(44px, 10vw, 70px);
      height: clamp(44px, 10vw, 70px);
      border-radius: 20px 20px 28px 28px;
      background: rgba(255, 213, 0, .95);
      box-shadow: 0 16px 40px rgba(0,0,0,.18);
      position: relative;
      transform-origin: 50% 0%;
      animation: bellSwing 1.1s ease-in-out infinite alternate;
    }
    .bell:before{
      content:"";
      position:absolute;
      top: -10%;
      left: 22%;
      width: 56%;
      height: 24%;
      border-radius: 999px;
      background: rgba(255,255,255,.35);
      filter: blur(.2px);
    }
    .bell:after{
      content:"";
      position:absolute;
      bottom: 10%;
      left: 46%;
      width: 10%;
      height: 16%;
      border-radius: 999px;
      background: rgba(0,0,0,.28);
    }
    .bell.right{ animation-delay: .18s; }
    @keyframes bellSwing{
      from{ transform: rotate(-10deg); }
      to  { transform: rotate(10deg); }
    }

    .rings{
      position: relative;
      width: min(420px, 100%);
      height: clamp(120px, 24vw, 160px);
      display:flex;
      align-items:center;
      justify-content:center;
      margin: 2px 0 2px;
    }
    .ring{
      position:absolute;
      width: clamp(74px, 16vw, 110px);
      height: clamp(74px, 16vw, 110px);
      border-radius: 50%;
      border: clamp(8px, 1.8vw, 12px) solid rgba(255, 213, 0, .95);
      box-shadow: 0 18px 46px rgba(0,0,0,.16);
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.10));
      opacity: .98;
    }
    .ring.a{
      transform: translateX(-28%) scale(.90);
      animation: ringA 1.8s ease-in-out infinite;
    }
    .ring.b{
      transform: translateX(28%) scale(.90);
      border-color: rgba(255,255,255,.92);
      animation: ringB 1.8s ease-in-out infinite;
    }
    @keyframes ringA{
      0%  { transform: translateX(-36%) translateY(8%) scale(.86); }
      55% { transform: translateX(-10%) translateY(0%) scale(.98); }
      100%{ transform: translateX(-36%) translateY(8%) scale(.86); }
    }
    @keyframes ringB{
      0%  { transform: translateX(36%) translateY(8%) scale(.86); }
      55% { transform: translateX(10%) translateY(0%) scale(.98); }
      100%{ transform: translateX(36%) translateY(8%) scale(.86); }
    }

    .sparkles{
      position:absolute;
      inset: -20%;
      pointer-events:none;
      opacity:.95;
    }
    .sparkle{
      position:absolute;
      width: clamp(6px, 1.8vw, 10px);
      height: clamp(6px, 1.8vw, 10px);
      background: rgba(255,255,255,.9);
      border-radius: 2px;
      transform: rotate(45deg);
      animation: twinkle 1.4s ease-in-out infinite;
      box-shadow: 0 0 18px rgba(255,255,255,.55);
    }
    @keyframes twinkle{
      0%,100%{ transform: scale(.6) rotate(45deg); opacity:.35; }
      50%    { transform: scale(1.15) rotate(45deg); opacity:1; }
    }
    .wedding-text{ font-weight: 900; line-height: 1.25; }
    .wedding-text .big{
      font-size: clamp(18px, 4.2vw, 26px);
      margin: 0;
    }
    .wedding-text .sub{
      margin: 6px 0 0;
      opacity:.92;
      font-weight: 900;
    }

    /* Celebration effects + "God's Plan" background */
    #celebrationScreen{
      position: relative;
      isolation: isolate;
    }
    #celebrationScreen::before{
      content:"GOD'S PLAN ‚Ä¢ GOD'S PLAN ‚Ä¢ GOD'S PLAN ‚Ä¢ GOD'S PLAN ‚Ä¢ GOD'S PLAN ‚Ä¢";
      position:absolute;
      inset:-30%;
      z-index:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      letter-spacing: 10px;
      font-size: clamp(28px, 6vw, 64px);
      opacity: .10;
      transform: rotate(-18deg);
      white-space: nowrap;
      pointer-events:none;
      text-shadow: 0 18px 60px rgba(0,0,0,.25);
    }
    #celebrationScreen::after{
      content:"";
      position:absolute;
      inset:0;
      z-index:1;
      background:
        radial-gradient(closest-side at 20% 25%, rgba(255,255,255,.18), transparent 55%),
        radial-gradient(closest-side at 80% 30%, rgba(0,255,204,.14), transparent 60%),
        radial-gradient(closest-side at 50% 85%, rgba(255,255,255,.12), transparent 60%);
      pointer-events:none;
    }
    .celebrate-title, .celebrate-sub, .celebrate-lead, .celebrate-actions,
    .benefits-top, .list { position: relative; z-index: 2; }

    .celebrate-title{
      display:inline-block;
      animation: popGlow 1.25s ease-in-out infinite;
      text-shadow:
        0 14px 34px rgba(0,0,0,.22),
        0 0 18px rgba(255,255,255,.22);
    }
    @keyframes popGlow{
      0%,100%{ transform: translateY(0) scale(1); filter: brightness(1); }
      50%    { transform: translateY(-4px) scale(1.02); filter: brightness(1.08); }
    }
    .celebrate-sub{
      display:inline-block;
      animation: floaty 2.2s ease-in-out infinite;
      text-shadow: 0 12px 28px rgba(0,0,0,.18);
    }
    @keyframes floaty{
      0%,100%{ transform: translateY(0); }
      50%    { transform: translateY(3px); }
    }

    .shine-line{
      width: min(520px, 100%);
      height: 10px;
      border-radius: 999px;
      margin: 10px auto 0;
      background: rgba(255,255,255,.16);
      border: 1px solid rgba(255,255,255,.14);
      overflow:hidden;
      position: relative;
      z-index: 2;
    }
    .shine-line::before{
      content:"";
      position:absolute;
      top:0; left:-40%;
      width:40%;
      height:100%;
      background: rgba(255,255,255,.35);
      transform: skewX(-22deg);
      animation: shine 1.6s ease-in-out infinite;
      opacity:.75;
    }
    @keyframes shine{
      0%{ left:-45%; }
      100%{ left:110%; }
    }

    /* Benefits checklist */
    .benefits-top{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      width:min(520px, 100%);
      margin: 10px auto 0;
    }
    .unlocked{
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.16);
      border-radius: 999px;
      padding: 8px 12px;
      font-weight: 900;
    }

    .list{
      list-style:none;
      padding:0;
      margin: 10px auto 6px;
      text-align:left;
      width: min(520px, 100%);
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.16);
      border-radius: 18px;
      padding: 12px 14px;
    }

    .benefit-item{
      padding: 8px 6px;
      border-bottom: 1px dashed rgba(255,255,255,.22);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .benefit-item:last-child{ border-bottom:none; }

    .benefit-label{
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
      cursor:pointer;
      user-select:none;
    }
    .benefit-check{
      width: 22px;
      height: 22px;
      accent-color: #00ffcc;
      flex: 0 0 auto;
    }
    .benefit-text{ font-weight: 900; }

    .benefit-item.checked{
      background: rgba(0,255,204,.10);
      border-radius: 14px;
    }
    .benefit-item.checked .benefit-text{
      text-shadow: 0 10px 24px rgba(0,0,0,.18);
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: max(env(safe-area-inset-bottom), 16px);
      transform: translateX(-50%);
      background: rgba(0,0,0,.45);
      border: 1px solid rgba(255,255,255,.16);
      color: white;
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 900;
      box-shadow: 0 16px 44px rgba(0,0,0,.26);
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 120;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }

    .burst{
      position: fixed;
      left: 50vw;
      top: 50vh;
      transform: translate(-50%,-50%);
      font-size: 26px;
      pointer-events:none;
      z-index: 90;
      text-shadow: 0 14px 28px rgba(0,0,0,.20);
      animation: burst 900ms ease-out forwards;
    }
    @keyframes burst{
      to{
        transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(.7);
        opacity: 0;
      }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{ animation: none !important; transition: none !important; }
      body{ overflow:auto; }
    }

    /* Small screens: stacked buttons */
    @media (max-width: 420px){
      .btn-row{ flex-direction:column; align-items:stretch; }
      button{ width:100%; }
      .controls{ right: 10px; bottom: 10px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- Question Screen -->
    <section class="screen active" id="questionScreen" aria-labelledby="qTitle">
      <h1 id="qTitle">Will you marry me? üíç‚ù§Ô∏è</h1>
      <p class="small">Please select one option. (Yes is emotionally encouraged.)</p>

      <div class="btn-row">
        <button class="yes" id="yesBtn" type="button">YES üòç</button>
        <button class="no" id="noBtn" type="button">NO üôÉ</button>
      </div>

      <div class="msg" id="message" role="status" aria-live="polite"></div>

      <div class="pill-row">
        <div class="pill" id="hintBtn" role="button" tabindex="0" aria-label="Show hint">Need a hint?</div>
        <div class="pill" id="restartBtn1" role="button" tabindex="0" aria-label="Restart">Restart</div>
      </div>
    </section>

    <!-- Loading Screen -->
    <section class="screen" id="loadingScreen" aria-labelledby="lTitle">
      <h1 id="lTitle">Processing your answer‚Ä¶ ü§ñ</h1>
      <p class="small" id="loadingJoke">Running romance.exe (please do not unplug love)</p>

      <div class="progress" aria-label="Verification progress">
        <div class="progress-bar" id="bar"></div>
      </div>
      <div class="percent" id="percent" aria-live="polite">0%</div>

      <div class="pill-row">
        <div class="pill" id="restartBtn2" role="button" tabindex="0" aria-label="Restart">Restart</div>
      </div>
    </section>

    <!-- Wedding Animation Screen -->
    <section class="screen" id="weddingScreen" aria-labelledby="wTitle">
      <h1 id="wTitle">Wedding bells loading‚Ä¶ üîîüíç</h1>
      <p class="small">Finalizing forever. Please hold tight (and my hand).</p>

      <div class="wedding-stage" aria-label="Wedding animation">
        <div class="sparkles" aria-hidden="true">
          <div class="sparkle" style="left:10%; top:18%; animation-delay:.1s;"></div>
          <div class="sparkle" style="left:22%; top:62%; animation-delay:.7s;"></div>
          <div class="sparkle" style="left:36%; top:30%; animation-delay:.3s;"></div>
          <div class="sparkle" style="left:50%; top:12%; animation-delay:.9s;"></div>
          <div class="sparkle" style="left:64%; top:42%; animation-delay:.5s;"></div>
          <div class="sparkle" style="left:78%; top:24%; animation-delay:.2s;"></div>
          <div class="sparkle" style="left:86%; top:66%; animation-delay:.8s;"></div>
        </div>

        <div class="wedding-grid">
          <div class="bells" aria-hidden="true">
            <div class="bell left"></div>
            <div class="bell right"></div>
          </div>

          <div class="rings" aria-hidden="true">
            <div class="ring a"></div>
            <div class="ring b"></div>
          </div>

          <div class="wedding-text">
            <p class="big">Activating: Happily Ever After ‚úÖ</p>
            <p class="sub" id="weddingCountdown">Taking you to the ceremony in 5‚Ä¶</p>
          </div>
        </div>
      </div>

      <div class="pill-row">
        <div class="pill" id="skipWeddingBtn" role="button" tabindex="0" aria-label="Skip animation">Skip</div>
        <div class="pill" id="restartBtn4" role="button" tabindex="0" aria-label="Restart">Restart</div>
      </div>
    </section>

    <!-- Celebration Screen -->
    <section class="screen" id="celebrationScreen" aria-labelledby="cTitle">
      <h1 id="cTitle" class="celebrate-title">üéâ CONGRATULATIONS üéâ</h1>
      <div class="shine-line" aria-hidden="true"></div>

      <h2 class="celebrate-sub">Love Mode: Activated üíç‚ù§Ô∏è</h2>
      <p class="small celebrate-lead">Benefits package includes the following (terms very cute, conditions apply):</p>

      <div class="benefits-top">
        <div class="unlocked" id="unlockedCount">Unlocked: 0/7</div>
        <div class="small" style="opacity:.95;">Tick a box to ‚Äúactivate‚Äù it</div>
      </div>

      <ul class="list" id="benefitsList">
        <li class="benefit-item" data-emoji="‚òï" data-toast="Chai dates unlocked. Cheers! ‚òï">
          <label class="benefit-label">
            <input class="benefit-check" type="checkbox" />
            <span class="benefit-text">Unlimited chai dates ‚òï</span>
          </label>
        </li>
        <li class="benefit-item" data-emoji="üöó" data-toast="Long drive mode: ON üöó">
          <label class="benefit-label">
            <input class="benefit-check" type="checkbox" />
            <span class="benefit-text">Random long drives üöó</span>
          </label>
        </li>
        <li class="benefit-item" data-emoji="üåû" data-toast="Good morning texts scheduled üåû">
          <label class="benefit-label">
            <input class="benefit-check" type="checkbox" />
            <span class="benefit-text">Daily good morning texts üåû</span>
          </label>
        </li>
        <li class="benefit-item" data-emoji="‚ù§Ô∏è" data-toast="Emotional support: premium tier ‚ù§Ô∏è">
          <label class="benefit-label">
            <input class="benefit-check" type="checkbox" />
            <span class="benefit-text">Emotional support, premium tier ‚ù§Ô∏è</span>
          </label>
        </li>
        <li class="benefit-item" data-emoji="ü§ó" data-toast="Hugs subscription activated ü§ó">
          <label class="benefit-label">
            <input class="benefit-check" type="checkbox" />
            <span class="benefit-text">Hugs subscription (auto-renews forever) ü§ó</span>
          </label>
        </li>
        <li class="benefit-item" data-emoji="üíª" data-toast="Tech support activated (even printers) üíª">
          <label class="benefit-label">
            <input class="benefit-check" type="checkbox" />
            <span class="benefit-text">Lifetime tech support (yes, even printers) üíª</span>
          </label>
        </li>
        <li class="benefit-item" data-emoji="üòé" data-toast="Bad jokes access granted üòé">
          <label class="benefit-label">
            <input class="benefit-check" type="checkbox" />
            <span class="benefit-text">VIP access to my bad jokes üòé</span>
          </label>
        </li>
      </ul>

      <div class="btn-row celebrate-actions" style="margin-top:14px;">
        <button class="yes" id="finalBtn" type="button">Seal it with a hug ü§ù‚ù§Ô∏è</button>
        <button style="background: rgba(255,255,255,.18); color:white; border:1px solid rgba(255,255,255,.20);" id="restartBtn3" type="button">Replay</button>
      </div>
    </section>
  </div>

  <div class="toast" id="toast" aria-live="polite"></div>

  <!-- Controls -->
  <div class="controls" aria-label="Controls">
    <button class="icon-btn" id="musicBtn" type="button" aria-label="Toggle music">üéµ</button>
    <button class="icon-btn" id="muteHeartsBtn" type="button" aria-label="Toggle hearts">‚ù§Ô∏è</button>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
      <h3 id="mTitle">Quick check-in üòÑ</h3>
      <p id="mBody">I will accept your ‚ÄúNO‚Äù‚Ä¶ but I‚Äôll be a little sad and dramatically stare out the window.</p>
      <div class="btn-row">
        <button id="modalClose" type="button" style="background: rgba(255,255,255,.18); color:white; border:1px solid rgba(255,255,255,.20);">Close</button>
        <button id="modalOk" type="button" class="yes">Okay‚Ä¶ YES üòç</button>
      </div>
    </div>
  </div>

  <audio id="bgMusic" loop preload="auto">
    <source src="love.mp3" type="audio/mpeg" />
  </audio>

  <script>
    // Code Generated by Sidekick is for learning and experimentation purposes only.
    const screens = {
      q: document.getElementById("questionScreen"),
      l: document.getElementById("loadingScreen"),
      w: document.getElementById("weddingScreen"),
      c: document.getElementById("celebrationScreen")
    };

    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const msg = document.getElementById("message");

    const bar = document.getElementById("bar");
    const percent = document.getElementById("percent");
    const loadingJoke = document.getElementById("loadingJoke");

    const music = document.getElementById("bgMusic");
    const musicBtn = document.getElementById("musicBtn");
    const muteHeartsBtn = document.getElementById("muteHeartsBtn");

    const modal = document.getElementById("modal");
    const modalClose = document.getElementById("modalClose");
    const modalOk = document.getElementById("modalOk");
    const hintBtn = document.getElementById("hintBtn");

    const skipWeddingBtn = document.getElementById("skipWeddingBtn");
    const weddingCountdown = document.getElementById("weddingCountdown");

    const restartBtns = ["restartBtn1","restartBtn2","restartBtn3","restartBtn4"]
      .map(id => document.getElementById(id));

    const finalBtn = document.getElementById("finalBtn");

    // Benefits elements
    const benefitsList = document.getElementById("benefitsList");
    const unlockedCount = document.getElementById("unlockedCount");
    const toast = document.getElementById("toast");
    let toastTimer = null;

    let musicStarted = false;
    let heartTimer = null;
    let heartsOn = true;

    let noCount = 0;
    let loadingTimer = null;

    let weddingTimer = null;
    let weddingTick = null;

    const noResponses = [
      "Bold choice. Incorrect‚Ä¶ but bold. üòå",
      "System message: ‚ÄúNO‚Äù has been moved to trash. üóëÔ∏è",
      "Plot twist: you‚Äôre actually pressing ‚ÄúYES‚Äù in slow motion. üê¢‚ù§Ô∏è",
      "Are you *sure* sure? Like‚Ä¶ triple sure? ü§î",
      "Okay okay, real choice unlocked. I‚Äôm listening. ü•∫"
    ];

    const loadingLines = [
      "Running romance.exe (please do not unplug love)",
      "Calibrating butterflies‚Ä¶ ü¶ã",
      "Consulting the universe‚Ä¶ it says YES.",
      "Encrypting feelings with 256-bit cuddles‚Ä¶",
      "Just a sec‚Äîmy heart is buffering ‚ù§Ô∏è‚Äçüî•"
    ];

    function switchScreen(hideEl, showEl){
      hideEl.classList.remove("active");
      showEl.classList.add("active");
    }

    async function startMusic(){
      if (musicStarted) return;
      try{
        music.volume = 0;
        await music.play();
        musicStarted = true;

        let vol = 0;
        const fade = setInterval(() => {
          vol = Math.min(1, vol + 0.06);
          music.volume = vol;
          if (vol >= 1) clearInterval(fade);
        }, 180);
      }catch(e){
        // autoplay blocked; user can press üéµ
      }
    }

    function toggleMusic(){
      if (!musicStarted){ startMusic(); return; }
      if (music.paused) music.play();
      else music.pause();
    }

    function openModal(text){
      document.getElementById("mBody").innerText = text;
      modal.classList.add("open");
      modalClose.focus();
    }
    function closeModal(){
      modal.classList.remove("open");
      yesBtn.focus();
    }

    function moveNoButton(){
      const padding = 16;
      const btnRect = noBtn.getBoundingClientRect();
      const maxX = window.innerWidth - btnRect.width - padding;
      const maxY = window.innerHeight - btnRect.height - padding;

      const x = Math.max(padding, Math.random() * maxX);
      const y = Math.max(padding, Math.random() * maxY);

      noBtn.style.position = "fixed";
      noBtn.style.left = x + "px";
      noBtn.style.top = y + "px";
      noBtn.style.zIndex = "60";
    }

    function resetNoButton(){
      noBtn.style.position = "relative";
      noBtn.style.left = "";
      noBtn.style.top = "";
      noBtn.style.zIndex = "";
    }

    function noClicked(){
      noCount++;
      msg.innerText = noResponses[Math.min(noCount - 1, noResponses.length - 1)];

      if (noCount <= 4) moveNoButton();
      else {
        resetNoButton();
        openModal("Okay. If it‚Äôs truly ‚ÄúNO,‚Äù I‚Äôll accept it‚Ä¶ but I‚Äôll miss you a lot. ‚ù§Ô∏è");
      }
    }

    function yesClicked(){
      msg.innerText = "";
      resetNoButton();
      switchScreen(screens.q, screens.l);
      startLoading();
    }

    function startLoading(){
      clearInterval(loadingTimer);
      let width = 0;
      bar.style.width = "0%";
      percent.innerText = "0%";

      loadingTimer = setInterval(() => {
        width++;
        bar.style.width = width + "%";
        percent.innerText = width + "%";

        if (width % 20 === 0){
          loadingJoke.innerText = loadingLines[(width/20 - 1) % loadingLines.length];
        }

        if (width >= 100){
          clearInterval(loadingTimer);
          startWeddingSequence();
        }
      }, 22);
    }

    // Countdown: 5,4,3,2,1 then ceremony
    function startWeddingSequence(){
      switchScreen(screens.l, screens.w);

      clearTimeout(weddingTimer);
      clearInterval(weddingTick);

      let n = 5;
      weddingCountdown.innerText = `Taking you to the ceremony in ${n}‚Ä¶`;

      weddingTick = setInterval(() => {
        n--;
        if (n >= 1){
          weddingCountdown.innerText = `Taking you to the ceremony in ${n}‚Ä¶`;
        } else {
          weddingCountdown.innerText = "Taking you to the ceremony‚Ä¶ NOW! üéâ";
          clearInterval(weddingTick);
        }
      }, 900);

      // allow the "NOW" line to show briefly
      weddingTimer = setTimeout(goCelebration, 5 * 900 + 500);
    }

    function goCelebration(){
      clearTimeout(weddingTimer);
      clearInterval(weddingTick);
      switchScreen(screens.w, screens.c);
      confettiHeartsBurst();
      updateUnlocked();
    }

    function restart(){
      clearInterval(loadingTimer);
      clearTimeout(weddingTimer);
      clearInterval(weddingTick);

      noCount = 0;
      msg.innerText = "";
      resetNoButton();

      screens.l.classList.remove("active");
      screens.w.classList.remove("active");
      screens.c.classList.remove("active");
      screens.q.classList.add("active");
    }

    function startHearts(){
      if (heartTimer || !heartsOn) return;
      heartTimer = setInterval(() => {
        if (document.hidden) return;

        const heart = document.createElement("div");
        heart.className = "heart";
        heart.textContent = ["‚ù§Ô∏è","üíñ","üíò","üíù"][Math.floor(Math.random()*4)];
        heart.style.left = (Math.random() * 100) + "vw";
        heart.style.animationDuration = (Math.random() * 2 + 3) + "s";
        heart.style.opacity = (Math.random() * 0.4 + 0.6).toFixed(2);
        document.body.appendChild(heart);

        setTimeout(() => heart.remove(), 5200);
      }, 550);
    }

    function stopHearts(){
      clearInterval(heartTimer);
      heartTimer = null;
    }

    function toggleHearts(){
      heartsOn = !heartsOn;
      muteHeartsBtn.style.opacity = heartsOn ? "1" : ".55";
      if (heartsOn) startHearts();
      else stopHearts();
    }

    function confettiHeartsBurst(){
      if (!heartsOn) return;
      for (let i=0; i<22; i++){
        setTimeout(() => {
          const h = document.createElement("div");
          h.className = "heart";
          h.textContent = ["‚ù§Ô∏è","üíñ","üíò","üíù","‚ú®"][Math.floor(Math.random()*5)];
          h.style.left = (Math.random()*100) + "vw";
          h.style.animationDuration = (Math.random()*1.2 + 2.2) + "s";
          document.body.appendChild(h);
          setTimeout(() => h.remove(), 4200);
        }, i*55);
      }
    }

    // Benefits interactions
    function showToast(text){
      if (!toast) return;
      toast.innerText = text;
      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.remove("show"), 1400);
    }

    function burstEmoji(emoji, count = 14){
      for (let i = 0; i < count; i++){
        const b = document.createElement("div");
        b.className = "burst";
        b.textContent = emoji;

        const dx = (Math.random() * 260 - 130).toFixed(0) + "px";
        const dy = (Math.random() * 220 - 140).toFixed(0) + "px";
        b.style.setProperty("--dx", dx);
        b.style.setProperty("--dy", dy);

        document.body.appendChild(b);
        setTimeout(() => b.remove(), 950);
      }
    }

    function updateUnlocked(){
      if (!benefitsList || !unlockedCount) return;
      const checks = benefitsList.querySelectorAll(".benefit-check");
      const checked = benefitsList.querySelectorAll(".benefit-check:checked");
      unlockedCount.innerText = `Unlocked: ${checked.length}/${checks.length}`;
    }

    function makeClickable(el, fn){
      el.addEventListener("click", fn);
      el.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " "){
          e.preventDefault();
          fn();
        }
      });
    }

    // Events
    yesBtn.addEventListener("click", () => { startMusic(); yesClicked(); });
    noBtn.addEventListener("click", () => { startMusic(); noClicked(); });

    musicBtn.addEventListener("click", (e) => { e.stopPropagation(); toggleMusic(); });
    muteHeartsBtn.addEventListener("click", (e) => { e.stopPropagation(); toggleHearts(); });

    modalClose.addEventListener("click", closeModal);
    modalOk.addEventListener("click", () => { closeModal(); yesClicked(); });

    makeClickable(hintBtn, () => openModal("Hint: the correct answer starts with Y and ends with ES. üòÑ"));
    makeClickable(skipWeddingBtn, goCelebration);
    restartBtns.forEach(b => b && makeClickable(b, restart));

    finalBtn.addEventListener("click", () => {
      openModal("Deal sealed. Now come here. ü§ù‚ù§Ô∏è");
      confettiHeartsBurst();
    });

    if (benefitsList){
      benefitsList.addEventListener("change", (e) => {
        const cb = e.target;
        if (!cb.classList || !cb.classList.contains("benefit-check")) return;

        const item = cb.closest(".benefit-item");
        if (!item) return;

        const emoji = item.getAttribute("data-emoji") || "‚ú®";
        const toastText = item.getAttribute("data-toast") || "Activated ‚ú®";

        item.classList.toggle("checked", cb.checked);
        updateUnlocked();

        if (cb.checked){
          burstEmoji(emoji, 16);
          showToast(toastText);

          const total = benefitsList.querySelectorAll(".benefit-check").length;
          const done = benefitsList.querySelectorAll(".benefit-check:checked").length;
          if (done === total) confettiHeartsBurst();
          else if (done === Math.ceil(total/2)) burstEmoji("üíç", 10);
        } else {
          showToast("Paused (you can re-activate anytime) üôÇ");
        }
      });

      updateUnlocked();
    }

    // Start hearts by default (unless reduced motion)
    const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    if (!reduceMotion) startHearts();

    // Keyboard shortcuts
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal.classList.contains("open")) closeModal();
      else if (e.key.toLowerCase() === "m") toggleMusic();
      else if (e.key.toLowerCase() === "r") restart();
    });

    // Stop background stuff when tab hidden
    document.addEventListener("visibilitychange", () => {
      if (document.hidden) stopHearts();
      else if (heartsOn && !reduceMotion) startHearts();
    });
  </script>
</body>
</html>
